<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<title>javaScript DOH test</title>

	<script type="text/javascript" src="../../../dojo/dojo.js"
		data-dojo-config="isDebug: true"></script>
	<script type="text/javascript">
		require([
			"doh/runner"
		], function(doh){
			doh.register("Object", [
			    {
			        name: "Charactor",
			        runTest: function(t){
			        	doh.is(typeof Object,         "function");
			        	
			        	doh.t(Object instanceof Object);
			        	doh.t(Object instanceof Function);
			        	
			        	doh.f(        Object.hasOwnProperty("__proto__"));  //hide property
			        	doh.t(        Object.getPrototypeOf(Object));
			        	doh.is(typeof Object.getPrototypeOf(Object), "function");
			        	doh.is(       Object.getPrototypeOf(Object), Object.__proto__);  
			        	doh.is(       Object.getPrototypeOf(Object), Function.prototype);
			        	
			        	doh.t(        Object.hasOwnProperty("prototype"));
			        	doh.is(typeof Object.prototype,     "object");
			        	doh.t(        Object.prototype.hasOwnProperty("__proto__"));
			        	doh.is(       Object.prototype.__proto__,   null); //null & undefined
			        	doh.f(        Object.prototype.hasOwnProperty("prototype"));
			        	doh.t(        Object.prototype.hasOwnProperty("constructor"));
			        	doh.is(       Object.prototype.constructor, Object);
			        	
			        	doh.f(Object.hasOwnProperty("constructor"));
			        }
			    },
			    {
			        name: "__proto__",   //__proto__ must be seted with javascript engine.
			        runTest: function(t){
			        	var noProto = Object.create(null);

			        	doh.is(typeof noProto.__proto__,       "undefined");
			        	doh.is(Object.getPrototypeOf(noProto), null);

			        	noProto.__proto__ = 17;

			        	doh.is(noProto.__proto__,  17);
			        	doh.is(Object.getPrototypeOf(noProto), null);

			        	var protoHidden = {};
			        	Object.defineProperty(protoHidden, "__proto__",
			        	                      { value: 42, writable: true, configurable: true, enumerable: true });

			        	doh.is(protoHidden.__proto__,  42);
			        	doh.is(Object.getPrototypeOf(protoHidden), Object.prototype);
			        }
			    }
			]);		
			
			doh.register("Function", [
			    {
			        name: "Charactor",
   	                runTest: function(t){
   	                	doh.is(typeof Function,       "function");
   	                	
   	                	doh.t(Function instanceof Function);
   	                	doh.t(Function instanceof Object);
   	                	
   	                	doh.f(        Function.hasOwnProperty("__proto__"));
   	                	doh.t(        Object.getPrototypeOf(Function));
   	                	doh.is(typeof Function.__proto__, "function");
   	                	doh.is(       Function.__proto__, Function.prototype);
   	               	   	                	
   	                	doh.t(        Function.hasOwnProperty("prototype"));
   	                	doh.is(typeof Function.prototype,           "function");
   	                	doh.is(typeof Function.prototype.__proto__, "object");
   	                	doh.is(       Function.prototype.__proto__, Object.prototype);
   	                	doh.f(        Function.prototype.hasOwnProperty("prototype"));
			       	    doh.t(        Function.prototype.hasOwnProperty("constructor"));
			       		doh.is(       Function.prototype.constructor, Function);

   	                	doh.f(Function.hasOwnProperty("constructor"));
   	                	
   	                }
			         
   	            }
			]);			

			doh.register("function", [
			    {
			        name: "Charactor",
			       	runTest: function(t){
			       		var f  = function(){};
			       		
			       		doh.is(typeof f,           "function");
			       		
			       		doh.t(f instanceof Object);
			       		doh.t(f instanceof Function);
			       		doh.f(f instanceof f);
			       		
			       		doh.f(f.hasOwnProperty("__proto__"));
			       		doh.t(Object.getPrototypeOf(f));
			       		doh.is(typeof f.__proto__,  "function");
			       		doh.is(       f.__proto__,  Function.prototype);
			       	 	
			       		doh.t(f.hasOwnProperty("prototype"));
			       		doh.is(typeof f.prototype,             "object");
			       		doh.is(       f.prototype.__proto__,   Object.prototype);
			       		doh.f(f.prototype.hasOwnProperty("prototype"));
			       		doh.is(       f.prototype.constructor, f);
			       		
			       		doh.f(f.hasOwnProperty("constructor"));
			       	}
				},
				{
			  	    name: "Reset Prototype",
			  	    runTest: function(t){
			  	    	var f  = function(){},
			  	    	obb = new f(),
			  	    	oba,
			  	    	fp;
			  	    	
			  	    	doh.is({},                          f.prototype);
			  	    	
			  	    	fp = f.prototype;
			  	    	f.prototype = {a:"d"};           //reset prototype
			  	    	oba = new f();
			  	    	
			  	    	doh.isNot(fp,                       f.prototype);
			  	    	doh.is(Object.getPrototypeOf(obb),  fp);
			  	    	doh.is(Object.getPrototypeOf(oba),  f.prototype);
			  	    	
			  	    }
			    },
				{
			  	    name: "Modify Prototype",
			  	    runTest: function(t){
			  	    	var f  = function(){},
			  	    	obb = new f(),
			  	    	oba,
			  	    	fp;

			  	    	fp = f.prototype;
			  	    	f.prototype.add = function(a,b){return a + b;};     //modify prototype
			  	    	oba = new f();
			  	    	
			  	    	doh.is(fp,                         f.prototype);
			  	    }
			    }
			]);
			
			doh.register("new object", [
			    {
			    	name: "Charactor",
			       	runTest: function(t){
			       		var f = function(){};
			       	    var no = new f();
			       	    
			       	    doh.is(typeof no,           "object");

			       	    doh.t(no instanceof Object);
			       		doh.f(no instanceof Function);
			       		doh.t(no instanceof f);
			       	    
			       		doh.f(no.hasOwnProperty("__proto__"));
			       		doh.t(Object.getPrototypeOf(no));
			       	    doh.is(typeof no.__proto__, "object");
			       	    doh.is(       no.__proto__, f.prototype);
			       	    doh.t(        no.__proto__.hasOwnProperty("constructor"));
			       		doh.is(       no.__proto__.constructor, f);

			       	    doh.f(no.hasOwnProperty("prototype"));
			       	    
			       		doh.f(no.hasOwnProperty("constructor"));
			       	}
			    }
			]);
			
			doh.register("Literal object", [
			    {
			        name: "Charactor",
			       	runTest: function(t){
			       		var ob  = {};
			     			       		
			       		doh.is(typeof ob,           "object");
			       		
			       		doh.t(ob instanceof Object);
			       		doh.f(ob instanceof Function);

			       		doh.f(ob.hasOwnProperty("__proto__"));
			       		doh.t(Object.getPrototypeOf(ob));
			       		doh.is(typeof ob.__proto__, "object");
			       		doh.is(       ob.__proto__, Object.prototype);
			       		doh.t(        ob.__proto__.hasOwnProperty("constructor"));
			       		doh.is(       ob.__proto__.constructor, Object);
			       		
			       		doh.f(ob.hasOwnProperty("prototype"));
			       		
			       		doh.f(ob.hasOwnProperty("constructor"));
			       	}
			    }
			]);

			doh.run();
		});
	</script>
</head>
<body class="claro" role="main">
	<h2>Tests for javaScript charactors</h2>
</body>
</html>
