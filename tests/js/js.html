<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<title>javaScript DOH test</title>

	<script type="text/javascript" src="../../../dojo/dojo.js"
		data-dojo-config="isDebug: true"></script>
	<script type="text/javascript">
		require([
			"doh/runner"
		], function(doh){
			doh.register("Object", [
			    {
			        name: "Charactor",
			        runTest: function(t){
			        	doh.is(typeof Object,         "function");
			        	
			        	doh.t(Object instanceof Object);
			        	doh.t(Object instanceof Function);
			        	
			        	doh.f(        Object.hasOwnProperty("__proto__"));  //hide property
			        	doh.t(        Object.getPrototypeOf(Object));
			        	doh.is(typeof Object.getPrototypeOf(Object), "function");
			        	doh.is(       Object.getPrototypeOf(Object), Object.__proto__);  
			        	doh.is(       Object.getPrototypeOf(Object), Function.prototype);
			        	
			        	doh.t(        Object.hasOwnProperty("prototype"));
			        	doh.is(typeof Object.prototype,     "object");
			        	doh.t(        Object.prototype.hasOwnProperty("__proto__"));
			        	doh.is(       Object.prototype.__proto__,   null); //null & undefined
			        	doh.f(        Object.prototype.hasOwnProperty("prototype"));
			        	doh.t(        Object.prototype.hasOwnProperty("constructor"));
			        	doh.is(       Object.prototype.constructor, Object);
			        	
			        	doh.f(Object.hasOwnProperty("constructor"));
			        }
			    },
			    {
			        name: "__proto__ & Object.getPrototypeOf() relationship", 
			        //Object.getPrototypeOf() value  must be preseted by javascript engine.
			        runTest: function(t){
			        	var noProto = Object.create(null);

			        	doh.is(typeof noProto.__proto__,       "undefined");
			        	doh.is(Object.getPrototypeOf(noProto), null);
                        //As undefined __proto__ property, you can define it in any value.
			        	noProto.__proto__ = 17;

			        	doh.is(noProto.__proto__,  17);
			        	doh.is(Object.getPrototypeOf(noProto), null);

			        	var protoHidden = {};
			        	//As already defined __proto__ property, you just can add it's own __proto__ with Object.defineProperty().
			        	Object.defineProperty(protoHidden, "__proto__",
			        	                      { value: 42, writable: true, configurable: true, enumerable: true });
						
			        	doh.is(protoHidden.__proto__,  42);
			        	doh.is(Object.getPrototypeOf(protoHidden), Object.prototype);
			        	
			        	noProto.__proto__     = new function a(){}; //do nothing,
			        	protoHidden.__proto__ = new function b(){}; //because both is own property.
			        	
			        	doh.is(Object.getPrototypeOf(noProto), null);
			        	doh.is(Object.getPrototypeOf(protoHidden), Object.prototype);
			        }
			    }
			    
			]);		
			
			doh.register("Function", [
			    {
			        name: "Charactor",
   	                runTest: function(t){
   	                	doh.is(typeof Function,       "function");
   	                	
   	                	doh.t(Function instanceof Function);
   	                	doh.t(Function instanceof Object);
   	                	
   	                	doh.f(        Function.hasOwnProperty("__proto__"));
   	                	doh.t(        Object.getPrototypeOf(Function));
   	                	doh.is(typeof Function.__proto__, "function");
   	                	doh.is(       Function.__proto__, Function.prototype);
   	               	   	                	
   	                	doh.t(        Function.hasOwnProperty("prototype"));
   	                	doh.is(typeof Function.prototype,           "function");
   	                	doh.is(typeof Function.prototype.__proto__, "object");
   	                	doh.is(       Function.prototype.__proto__, Object.prototype);
   	                	doh.f(        Function.prototype.hasOwnProperty("prototype"));
			       	    doh.t(        Function.prototype.hasOwnProperty("constructor"));
			       		doh.is(       Function.prototype.constructor, Function);

   	                	doh.f(Function.hasOwnProperty("constructor"));
   	                	
   	                }
			         
   	            }
			]);			

			doh.register("function", [
			    {
			        name: "Charactor",
			       	runTest: function(t){
			       		var f  = function(){};
			       		
			       		doh.is(typeof f,           "function");
			       		
			       		doh.t(f instanceof Object);
			       		doh.t(f instanceof Function);
			       		doh.f(f instanceof f);
			       		
			       		doh.f(f.hasOwnProperty("__proto__"));
			       		doh.t(Object.getPrototypeOf(f));
			       		doh.is(typeof f.__proto__,  "function");
			       		doh.is(       f.__proto__,  Function.prototype);
			       	 	
			       		doh.t(f.hasOwnProperty("prototype"));
			       		doh.is(typeof f.prototype,             "object");
			       		doh.is(       f.prototype.__proto__,   Object.prototype);
			       		doh.f(f.prototype.hasOwnProperty("prototype"));
			       		doh.is(       f.prototype.constructor, f);
			       		
			       		doh.f(f.hasOwnProperty("constructor"));
			       	}
				},
				
				{
			  	    name: "Reset Prototype",
			  	    runTest: function(t){
			  	    	var f  = function(){},
			  	    	obb = new f(),
			  	    	oba,
			  	    	fp;
			  	    	
			  	    	doh.is({},                          f.prototype);
			  	    	doh.is(obb.constructor,             f);
			  	    	
			  	    	fp = f.prototype;
			  	    	f.prototype = {a:"d"};           //reset prototype
			  	    	oba = new f();
			  	    	
			  	    	doh.isNot(fp,                       f.prototype);
			  	    	doh.is(Object.getPrototypeOf(obb),  fp);
			  	    	doh.is(Object.getPrototypeOf(oba),  f.prototype);
			  	    	
			  	    	doh.is(obb.constructor,             f);
			  	    	doh.is(oba.constructor,             Object);
			  	    	
			  	    }
			    },
			    
				{
			  	    name: "Modify Prototype",
			  	    runTest: function(t){
			  	    	var f  = function(){},
			  	    	obb = new f(),
			  	    	oba,
			  	    	fp;

			  	    	fp = f.prototype;
			  	    	f.prototype.add = function(a,b){return a + b;};     //modify prototype
			  	    	oba = new f();
			  	    	
			  	    	doh.is(fp,                         f.prototype);
			  	    }
			    },

			    {
			        name: "Inheritance & __proto__ relationship", 
			        //Inheritance affected by value of __proto__.
			        runTest: function(t){
			        	var f = function(){};
			        	var ob = new f();
			        	
			        	doh.is(f.prototype, ob.__proto__);
			        	doh.is(f.prototype, Object.getPrototypeOf(ob));
			        	
			        	ob.__proto__ = 6;//Must be object or null, else it do nothing.
			        	doh.is(f.prototype, ob.__proto__);
			        	
			        	var b = {a:"a"};
			        	ob.__proto__ = b;
			        	doh.is(b, ob.__proto__);               
			        	doh.is(b, Object.getPrototypeOf(ob));  //change [[prototype]], bacause __proto__ is inheritated from Object.
			        	
			        	Object.defineProperty(ob, "__proto__",
      	                      { value: 42, writable: true, configurable: true, enumerable: true });
			        	
			        	var c = {a:6}
			        	ob.__proto__ = c;
			        	doh.is(c, ob.__proto__);               
			        	doh.is(b, Object.getPrototypeOf(ob));  //Do not change [[prototype]], bacause __proto__ is own property.

			        }
			    }
			]);
			
			doh.register("new object", [
			    {
			    	name: "Charactor",
			       	runTest: function(t){
			       		var f = function(){};
			       	    var no = new f();
			       	    
			       	    doh.is(typeof no,           "object");

			       	    doh.t(no instanceof Object);
			       		doh.f(no instanceof Function);
			       		doh.t(no instanceof f);
			       	    
			       		doh.f(no.hasOwnProperty("__proto__"));
			       		doh.t(Object.getPrototypeOf(no));
			       	    doh.is(typeof no.__proto__, "object");
			       	    doh.is(       no.__proto__, f.prototype);
			       	    doh.t(        no.__proto__.hasOwnProperty("constructor"));
			       		doh.is(       no.__proto__.constructor, f);

			       	    doh.f(no.hasOwnProperty("prototype"));
			       	    
			       		doh.f(no.hasOwnProperty("constructor"));
			       	}
			    }
			]);
			
			doh.register("Literal object", [
			    {
			        name: "Charactor",
			       	runTest: function(t){
			       		var ob  = {};
			     			       		
			       		doh.is(typeof ob,           "object");
			       		
			       		doh.t(ob instanceof Object);
			       		doh.f(ob instanceof Function);

			       		doh.f(ob.hasOwnProperty("__proto__"));
			       		doh.t(Object.getPrototypeOf(ob));
			       		doh.is(typeof ob.__proto__, "object");
			       		doh.is(       ob.__proto__, Object.prototype);
			       		doh.t(        ob.__proto__.hasOwnProperty("constructor"));
			       		doh.is(       ob.__proto__.constructor, Object);
			       		
			       		doh.f(ob.hasOwnProperty("prototype"));
			       		
			       		doh.f(ob.hasOwnProperty("constructor"));
			       	}
			    }
			]);
			
			doh.register("Inheritance and the prototype chain", [
			    {
			    	name: "Inheriting properties",
				    runTest: function(t){
				    	var f = function(){};
				    	f.prototype.a = "dd";
				    	
				    	var ob = new f();
				    	
				    	doh.is(ob.a,  "dd");
				    	
				    	ob.a = "s";
				    	
				    	doh.is(ob.a,  "s");
				    	doh.is(Object.getPrototypeOf(ob).a, "dd");
				       		
				    }
			    },
			    {
			    	name: "Inheriting 'methods'",
				    runTest: function(t){
				    	var o = {
				    	    a: 2,
				    	    m: function(b){
				    	        return this.a + 1;
				    		}
				    	};

				    	doh.is(o.m(),  3);
				    	// When calling o.m in this case, 'this' refers to o

				    	var p = Object.create(o);
				    	// p is an object that inherits from o

				    	p.a = 12; // creates an own property 'a' on p
				    	doh.is(p.m(), 13);
				    	// when p.m is called, 'this' refers to p.
				    	// So when p inherits the function m of o, 'this.a' means p.a, the own property 'a' of p
				    }
			    },
			    {
			    	name: "Objects created with syntax constructs",
				    runTest: function(t){
				    	var o = {a: 1};

				    	// The newly created object o has Object.prototype as its [[Prototype]]
				    	// o has no own property named 'hasOwnProperty'
				    	// hasOwnProperty is an own property of Object.prototype. So o inherits hasOwnProperty from Object.prototype
				    	// Object.prototype has null as its prototype.
				    	// o ---> Object.prototype ---> null
				    	
				    	doh.is(Object.getPrototypeOf(o),  Object.prototype);
				    	doh.is(Object.getPrototypeOf(Object.prototype), null);

				    	var a = ["yo", "whadup", "?"];

				    	// Arrays inherit from Array.prototype (which has methods like indexOf, forEach, etc.)
				    	// The prototype chain looks like:
				    	// a ---> Array.prototype ---> Object.prototype ---> null

				    	doh.is(Object.getPrototypeOf(a),  Array.prototype);
				    	doh.is(Object.getPrototypeOf(Array.prototype),  Object.prototype);
				    	
				    	function f(){
				    	  return 2;
				    	}

				    	// Functions inherit from Function.prototype (which has methods like call, bind, etc.)
				    	// f ---> Function.prototype ---> Object.prototype ---> null
				    	
				    	doh.is(Object.getPrototypeOf(f),  Function.prototype);
				    	doh.is(Object.getPrototypeOf(Function.prototype),  Object.prototype);
				    }
			    },
			    {
			    	name: "With a constructor",
				    runTest: function(t){
				    	function Graph() {
				    	    this.vertexes = [];
				    	    this.edges = [];
				    	}

				    	Graph.prototype = {
				    	    addVertex: function(v){
				                 this.vertexes.push(v);
				    		}
				    	};

				    	var g = new Graph();
				    	// g is an object with own properties 'vertexes' and 'edges'.
				    	// g.[[Prototype]] is the value of Graph.prototype when new Graph() is executed.
				    	
				    	g.addVertex("dd");
				    	doh.is(g.vertexes, ["dd"]);
				    	
				    	doh.is(Graph.prototype, Object.getPrototypeOf(g));
				    }
			    },
			    {
			    	name: "With Object.create",
				    runTest: function(t){
				    	var a = {a: 1}; 
				    	// a ---> Object.prototype ---> null
				    	doh.is(Object.getPrototypeOf(a), Object.prototype);

				    	var b = Object.create(a);
				    	// b ---> a ---> Object.prototype ---> null
				    	doh.is(b.a, 1);
				    	doh.is(Object.getPrototypeOf(b), a);

				    	var c = Object.create(b);
				    	// c ---> b ---> a ---> Object.prototype ---> null
				    	doh.is(Object.getPrototypeOf(c), b);

				    	var d = Object.create(null);
				    	// d ---> null
				    	doh.is(d.hasOwnProperty, undefined); // undefined, because d doesn't inherit from Object.prototype
				    }
			    }
			    
			    
			])

			doh.run();
		});
	</script>
</head>
<body class="claro" role="main">
	<h2>Tests for javaScript charactors</h2>
</body>
</html>
