<?xml version="1.0" encoding="UTF-8" ?>
<project name="mijit" default="begindev" basedir=".." >
	
    <!--  all properties are in build.properties -->
    <property file="build/build.properties" />
	
	<!-- additional ant tasks' CLASSPATH defination for all build files -->
	<taskdef resource="net/sf/antcontrib/antlib.xml">
		<classpath>
			<pathelement location="build/ants/ant-contrib/ant-contrib-1.0b3.jar"/>
		</classpath>
	</taskdef>
	
	<!--  all other build files. -->
	<import file="${dojoBuild}"/>
	
	<target name="gitInit">
		<echo>Set git global environment variable &amp; alias.</echo>
		<exec executable = "bash">
		   	<arg value = "-c" />
		   	<arg value = "
		   		${gitConfig} user.name  brgd;
		   		${gitConfig} user.email hohhots@gmail.com;
		   		${gitConfig} push.default matching;
		   		${gitConfig} branch.autosetuprebase always;
		   		${gitConfig} color.ui true;
		   		${gitConfig} color.status auto;
		   		${gitConfig} color.branch auto;
		   		${gitConfig} alias.co checkout;
		   		${gitConfig} alias.ci commit;
		   		${gitConfig} alias.st status;
		   		${gitConfig} alias.xfetch 'fetch origin';
		   		${gitConfig} alias.xdiff 'diff origin master';
		   		${gitConfig} alias.xmerge 'merge origin master';
		   		${gitConfig} alias.xpull 'pull origin master';
		   		${gitConfig} alias.xpush 'push origin master';
		   		${gitConfig} alias.br branch;
		   		${gitConfig} alias.type 'cat-file -t';
		   		${gitConfig} alias.dump 'cat-file -p';
		   		${gitConfig} alias.hist 'log --pretty=format:\&quot;%h %ad | %s%d [%an]\&quot; --graph --date=short'
		   		" />
		</exec>
		<echo>OK!</echo>
	</target>

	<target name="gitFetch">
			<exec executable = "bash">
				<arg value = "-c" />
				<arg value = "git xfetch &amp;" />
		    </exec>
	</target>
	
	<target name="IfRemoteHasNew">
		<antcall target="gitFetch" /> 
		<echo>Check none fetched changes of remote repository.</echo>
		<echo>&gt;&gt;&gt;&gt;&gt;&gt;&gt;</echo>
		<exec executable = "bash">
			<arg value = "-c" />
			<arg value = "git xdiff | grep -- '^[+-]'" />
	    </exec>
		<echo>&lt;&lt;&lt;&lt;&lt;&lt;&lt; </echo>
	</target>
	
	<target name="startEclipse" >
		<exec executable = "bash">
			<arg value = "-c" />
			<arg value = "eclipse &amp;" />
		</exec>
	</target>
	
	<target name="pullMijit" >
		<exec executable = "bash">
			<arg value = "-c" />
			<arg value = "${gitXpull}" />
	    </exec>
	</target>
			
	<target name="begindev">
		<antcall target="gitInit" />
		<antcall target="initDojo" />
		<antcall target="enddev" />
		
		<echo>Start to develop!</echo>
		<input
		    message="Do you want to start to develop(y/n)?"
		    validargs="y,n"
		    addproperty="do.delete"
		/>
		
		<condition property="do.abort">
		    <equals arg1="n" arg2="${do.delete}"/>
		</condition>
		<fail if="do.abort">Stopped by user.</fail>
		
		<antcall target="pullMijit" /> 
		<antcall target="startEclipse" /> 
		<echo>Started!</echo>
	</target>
	
	<target name="enddev" >
		<antcall target="IfRemoteHasNew" />
		<echo>Check local repository state.</echo>
		<echo>&gt;&gt;&gt;&gt;&gt;&gt;&gt;</echo>
		<exec executable = "bash">
	    	<arg value = "-c" />
			<arg value = "git st" />
	    </exec>
	    <echo>&lt;&lt;&lt;&lt;&lt;&lt;&lt; </echo>
	</target>
</project>
